# ==============================================
# AutoShip 后端环境配置示例
# ==============================================
# 复制此文件为 .env 并填写实际配置值

# 基础配置
NODE_ENV=development
PORT=3100
BASE_URL=http://localhost:3100
FRONTEND_URL=http://localhost:5173

# 数据库配置
DATABASE_PATH=./database.db

# ==============================================
# 支付网关配置
# ==============================================

# 启用/禁用支付网关
PAYMENT_ALIPAY_ENABLED=false
PAYMENT_CREEM_ENABLED=false

# 支付宝配置 (主要支付网关)
# 获取方式：支付宝开放平台 -> 应用管理
PAYMENT_ALIPAY_APP_ID=你的支付宝应用APP_ID
PAYMENT_ALIPAY_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\n你的私钥\n-----END PRIVATE KEY-----
PAYMENT_ALIPAY_PUBLIC_KEY=-----BEGIN PUBLIC KEY-----\n支付宝公钥\n-----END PUBLIC KEY-----
PAYMENT_ALIPAY_GATEWAY_URL=https://openapi.alipay.com/gateway.do
PAYMENT_ALIPAY_VERSION=1.0
PAYMENT_ALIPAY_TIMEOUT=30000
PAYMENT_ALIPAY_RETRY_COUNT=3

# Creem配置 (备用支付网关)
# 获取方式：Creem开发者平台
PAYMENT_CREEM_API_KEY=你的Creem_API_Key
PAYMENT_CREEM_WEBHOOK_SECRET=你的Webhook密钥
PAYMENT_CREEM_BASE_URL=https://api.creem.io
PAYMENT_CREEM_TIMEOUT=30000
PAYMENT_CREEM_RETRY_COUNT=3

# 支付通用配置
PAYMENT_WEBHOOK_TIMEOUT=30
PAYMENT_AMOUNT_TOLERANCE=0.01

# ==============================================
# Webhook处理配置
# ==============================================
# Webhook处理超时时间（毫秒）
WEBHOOK_PROCESSING_TIMEOUT=30000

# Webhook失败重试次数
WEBHOOK_MAX_RETRIES=3

# Webhook幂等性检查窗口时间（秒）
WEBHOOK_IDEMPOTENCY_WINDOW=86400

# Webhook速率限制（每分钟最大请求数）
WEBHOOK_RATE_LIMIT=10

# 可疑Webhook检测
WEBHOOK_SUSPICIOUS_DETECTION=true
WEBHOOK_SUSPICIOUS_THRESHOLD=5

# ==============================================
# 邮件服务配置 (Resend)
# ==============================================
# 获取方式：https://resend.com
EMAIL_RESEND_API_KEY=你的Resend_API_Key
EMAIL_FROM_EMAIL=noreply@yoursite.com
EMAIL_FROM_NAME=AutoShip
EMAIL_SMTP_TIMEOUT=30

# ==============================================
# 安全配置
# ==============================================
# 用于加密配置和生成安全令牌
JWT_SECRET=你的JWT密钥_至少64个字符
CONFIG_ENCRYPTION_KEY=你的配置加密密钥_32个字符

# 管理员配置
ADMIN_API_KEY=你的管理员API密钥
ADMIN_SESSION_TIMEOUT=3600

# ==============================================
# 监控和日志配置
# ==============================================
LOG_LEVEL=info
MONITORING_ENABLED=true

# Sentry (可选)
# 获取方式：https://sentry.io
SENTRY_DSN=你的Sentry_DSN

# ==============================================
# 兼容性配置 (旧版本兼容)
# ==============================================
# 这些配置项已保留以兼容旧版本
DB_PATH=./database.db
DEFAULT_GATEWAY=alipay
ALLOW_GATEWAY_PARAM=true
SITE_BASE_URL=http://localhost:5173
ALIPAY_APP_ID=${PAYMENT_ALIPAY_APP_ID}
ALIPAY_APP_PRIVATE_KEY=${PAYMENT_ALIPAY_PRIVATE_KEY}
ALIPAY_PUBLIC_KEY=${PAYMENT_ALIPAY_PUBLIC_KEY}
ALIPAY_GATEWAY_HOST=${PAYMENT_ALIPAY_GATEWAY_URL}
ALIPAY_RETURN_URL=${FRONTEND_URL}/payment/return
ALIPAY_NOTIFY_URL=${BASE_URL}/webhooks/alipay
CREEM_API_KEY=${PAYMENT_CREEM_API_KEY}
CREEM_WEBHOOK_SECRET=${PAYMENT_CREEM_WEBHOOK_SECRET}
CREEM_WEBHOOK_URL=${BASE_URL}/webhooks/creem
RESEND_API_KEY=${EMAIL_RESEND_API_KEY}
ADMIN_SECRET=${ADMIN_API_KEY}
DOWNLOAD_EXPIRE_HOURS=72
MAX_DOWNLOADS=3
