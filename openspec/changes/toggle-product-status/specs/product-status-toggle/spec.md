# 商品状态切换功能规范

## ADDED Requirements

### Requirement: 商品状态显示功能
系统 SHALL 在商品管理界面清晰显示每个商品的当前上架状态。

#### Scenario: 显示商品状态标签
- **GIVEN** 管理员在商品管理页面
- **WHEN** 系统加载商品列表
- **THEN** 每个商品 SHALL 显示状态标签：
  - "已上架" - 绿色标签，表示商品在前台可见
  - "已下架" - 灰色标签，表示商品在前台不可见
  - 状态标签位于商品名称附近或操作列中

#### Scenario: 状态图标显示
- **GIVEN** 管理员查看商品列表
- **WHEN** 系统渲染商品状态
- **THEN** 系统 SHALL 在状态标签旁显示对应图标：
  - 上架状态：显示眼睛图标或向上箭头图标
  - 下架状态：显示眼睛关闭图标或向下箭头图标

### Requirement: 单个商品状态切换功能
系统 SHALL 允许管理员一键切换单个商品的上架/下架状态。

#### Scenario: 上架商品操作
- **GIVEN** 管理员在商品管理页面看到已下架商品
- **WHEN** 管理员点击"上架"按钮
- **THEN** 系统 SHALL：
  1. 显示确认对话框："确定要上架商品 [商品名称] 吗？"
  2. 确认后发送 API 请求更新商品状态
  3. 成功后显示成功消息："商品已成功上架"
  4. 立即更新界面状态显示

#### Scenario: 下架商品操作
- **GIVEN** 管理员在商品管理页面看到已上架商品
- **WHEN** 管理员点击"下架"按钮
- **THEN** 系统 SHALL：
  1. 显示确认对话框："确定要下架商品 [商品名称] 吗？下架后商品将不在前台显示。"
  2. 确认后发送 API 请求更新商品状态
  3. 成功后显示成功消息："商品已成功下架"
  4. 立即更新界面状态显示

#### Scenario: 状态切换按钮动态显示
- **GIVEN** 管理员查看商品列表
- **WHEN** 系统渲染商品操作按钮
- **THEN** 系统 SHALL 根据商品状态显示相应按钮：
  - 已上架商品：显示"下架"按钮（红色或橙色）
  - 已下架商品：显示"上架"按钮（绿色或蓝色）
  - 按钮文本和颜色清晰指示操作效果

### Requirement: 批量商品状态操作功能
系统 SHALL 支持管理员批量选择多个商品并同时更新其状态。

#### Scenario: 批量选择商品
- **GIVEN** 管理员在商品管理页面
- **WHEN** 管理员需要操作多个商品
- **THEN** 系统 SHALL 提供：
  - 每行商品前的复选框
  - 全选/取消全选的复选框
  - 选中数量的实时显示

#### Scenario: 批量上架操作
- **GIVEN** 管理员已选择多个已下架商品
- **WHEN** 管理员点击批量操作菜单中的"批量上架"
- **THEN** 系统 SHALL：
  1. 显示确认对话框："确定要上架选中的 [N] 个商品吗？"
  2. 显示选中商品列表预览
  3. 确认后并发发送 API 请求
  4. 显示批量操作进度指示器
  5. 完成后显示操作结果摘要

#### Scenario: 批量下架操作
- **GIVEN** 管理员已选择多个已上架商品
- **WHEN** 管理员点击批量操作菜单中的"批量下架"
- **THEN** 系统 SHALL：
  1. 显示确认对话框："确定要下架选中的 [N] 个商品吗？下架后这些商品将不在前台显示。"
  2. 显示选中商品列表预览
  3. 确认后并发发送 API 请求
  4. 显示批量操作进度指示器
  5. 完成后显示操作结果摘要

### Requirement: 状态变更确认机制
系统 SHALL 提供适当的确认机制防止误操作。

#### Scenario: 单个商品操作确认
- **GIVEN** 管理员点击上架/下架按钮
- **WHEN** 系统需要确认操作
- **THEN** 系统 SHALL 显示模态对话框包含：
  - 明确的操作描述（上架/下架）
  - 商品名称标识
  - 操作后果说明（特别是下架操作）
  - "确认"和"取消"按钮
  - 可选的"不再提示"复选框

#### Scenario: 批量操作确认
- **GIVEN** 管理员选择多个商品进行批量操作
- **WHEN** 系统需要确认批量操作
- **THEN** 系统 SHALL 显示详细的确认对话框包含：
  - 操作类型和影响商品数量
  - 受影响商品的简要列表（可滚动查看）
  - 操作的重要后果说明
  - "确认"和"取消"按钮
  - 详细的操作进度反馈

### Requirement: API 集成与错误处理
系统 SHALL 提供可靠的后端 API 支持和完善的错误处理机制。

#### Scenario: 状态更新 API 调用
- **WHEN** 管理员确认状态变更操作
- **THEN** 系统 SHALL：
  1. 发送 PUT/PATCH 请求到商品状态更新端点
  2. 包含商品 ID 和新的 is_active 状态值
  3. 在请求头中包含管理员认证信息
  4. 设置适当的超时时间

#### Scenario: API 请求失败处理
- **GIVEN** 系统发送状态更新请求
- **WHEN** API 请求失败（网络错误、服务器错误等）
- **THEN** 系统 SHALL：
  - 显示错误消息："操作失败，请稍后重试"
  - 记录详细错误信息到控制台
  - 保持商品原有状态显示不变
  - 提供重试按钮
  - 不关闭确认对话框（如果是批量操作）

#### Scenario: 认证失败处理
- **GIVEN** 管理员进行状态操作
- **WHEN** API 返回 401 或 403 错误
- **THEN** 系统 SHALL：
  - 显示"权限不足，请重新登录"消息
  - 清除本地认证信息
  - 重定向到管理员登录页面
  - 不显示商品管理界面

### Requirement: 操作反馈与用户体验
系统 SHALL 提供清晰的操作反馈和良好的用户体验。

#### Scenario: 操作成功反馈
- **GIVEN** 商品状态操作成功完成
- **WHEN** 系统收到成功响应
- **THEN** 系统 SHALL：
  - 显示成功通知消息
  - 立即更新商品状态显示
  - 更新相关按钮和标签
  - 刷新商品列表数据（可选）

#### Scenario: 加载状态指示
- **GIVEN** 系统正在处理状态变更请求
- **WHEN** 等待 API 响应期间
- **THEN** 系统 SHALL：
  - 显示加载指示器在操作按钮上
  - 禁用相关按钮防止重复点击
  - 显示"处理中..."文本提示
  - 保持其他界面元素可交互

#### Scenario: 响应式设计
- **GIVEN** 管理员使用不同设备访问
- **WHEN** 系统渲染状态切换功能
- **THEN** 系统 SHALL：
  - 移动端：状态标签和按钮布局紧凑但不拥挤
  - 平板端：合理利用屏幕空间显示更多信息
  - 桌面端：提供完整的批量操作功能
  - 所有设备：按钮和标签易于点击和查看