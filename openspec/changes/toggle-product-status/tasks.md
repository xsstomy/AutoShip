# 商品上架/下架功能实现任务清单

## 任务概述
实现商品管理系统的上架/下架功能，包括单个和批量操作，提供直观的状态显示和操作界面。

## 详细任务列表

### Phase 1: 后端 API 开发

#### 1.1 创建商品状态更新 API 端点
- [ ] 在 `Backend/src/routes/admin-products.ts` 中添加 PATCH 端点 `/admin/products/:id/status`
- [ ] 实现单个商品状态更新逻辑
- [ ] 添加请求参数验证（productId, isActive）
- [ ] 添加管理员权限验证中间件
- [ ] 实现数据库更新操作（更新 products 表的 is_active 字段）

#### 1.2 实现批量状态更新 API 端点
- [ ] 在 `Backend/src/routes/admin-products.ts` 中添加 POST 端点 `/admin/products/batch-status`
- [ ] 实现批量状态更新逻辑
- [ ] 添加请求参数验证（productIds[], isActive）
- [ ] 实现事务处理确保数据一致性
- [ ] 添加操作结果统计返回

#### 1.3 添加错误处理和验证
- [ ] 实现商品存在性验证
- [ ] 添加参数格式验证
- [ ] 实现数据库操作异常处理
- [ ] 添加详细的错误日志记录
- [ ] 返回标准化的错误响应格式

### Phase 2: 前端界面组件

#### 2.1 创建状态显示组件
- [ ] 创建 `ProductStatusBadge.tsx` 组件
- [ ] 实现状态标签样式（绿色/灰色）
- [ ] 添加状态图标显示
- [ ] 支持不同尺寸和主题

#### 2.2 实现状态切换按钮组件
- [ ] 创建 `ProductStatusToggle.tsx` 组件
- [ ] 实现上架/下架按钮的动态显示
- [ ] 添加按钮加载状态
- [ ] 实现按钮禁用逻辑

#### 2.3 创建确认对话框组件
- [ ] 创建 `StatusConfirmDialog.tsx` 组件
- [ ] 实现单个商品操作确认界面
- [ ] 添加商品信息显示
- [ ] 实现"不再提示"功能
- [ ] 添加自定义确认消息

### Phase 3: 商品管理页面集成

#### 3.1 更新商品列表界面
- [ ] 修改 `AdminProductManagement.tsx` 添加状态列
- [ ] 集成 `ProductStatusBadge` 组件
- [ ] 添加状态切换按钮到操作列
- [ ] 实现状态数据的本地缓存

#### 3.2 实现单个商品状态操作
- [ ] 添加状态切换按钮点击处理
- [ ] 集成确认对话框显示逻辑
- [ ] 实现 API 调用和状态更新
- [ ] 添加操作成功/失败反馈
- [ ] 实现乐观 UI 更新

#### 3.3 添加批量选择功能
- [ ] 在商品列表添加复选框列
- [ ] 实现全选/取消全选功能
- [ ] 添加选中计数显示
- [ ] 实现选中状态管理

### Phase 4: 批量操作功能

#### 4.1 创建批量操作界面
- [ ] 创建 `BatchOperations.tsx` 组件
- [ ] 实现批量操作下拉菜单
- [ ] 添加批量操作按钮（上架/下架）
- [ ] 实现批量操作状态显示

#### 4.2 实现批量确认对话框
- [ ] 创建 `BatchConfirmDialog.tsx` 组件
- [ ] 显示选中商品列表预览
- [ ] 添加操作进度指示器
- [ ] 实现批量操作结果统计

#### 4.3 处理批量操作逻辑
- [ ] 实现并发 API 调用逻辑
- [ ] 添加批量操作进度跟踪
- [ ] 处理部分失败的情况
- [ ] 实现批量操作结果反馈

### Phase 5: 用户体验优化

#### 5.1 添加加载状态和反馈
- [ ] 实现按钮加载动画
- [ ] 添加操作进度提示
- [ ] 实现操作成功通知
- [ ] 添加操作失败重试机制

#### 5.2 响应式设计适配
- [ ] 优化移动端状态显示布局
- [ ] 调整批量操作在移动端的显示
- [ ] 实现触摸友好的按钮尺寸
- [ ] 测试各种屏幕尺寸的显示效果

#### 5.3 辅助功能和可访问性
- [ ] 添加键盘导航支持
- [ ] 实现屏幕阅读器友好标签
- [ ] 添加足够的颜色对比度
- [ ] 实现焦点管理

### Phase 6: 测试和验证

#### 6.1 功能测试
- [ ] 测试单个商品上架/下架操作
- [ ] 测试批量操作功能
- [ ] 验证确认对话框工作正常
- [ ] 测试错误处理机制
- [ ] 验证权限控制

#### 6.2 集成测试
- [ ] 测试前后端 API 集成
- [ ] 验证数据库状态更新
- [ ] 测试并发操作处理
- [ ] 验证缓存更新机制

#### 6.3 用户体验测试
- [ ] 测试各种设备的操作体验
- [ ] 验证加载状态显示
- [ ] 测试错误恢复流程
- [ ] 收集用户反馈并优化

### Phase 7: 文档和部署

#### 7.1 更新文档
- [ ] 更新 API 文档说明新增端点
- [ ] 编写功能使用说明
- [ ] 更新管理员操作手册
- [ ] 添加故障排除指南

#### 7.2 部署准备
- [ ] 进行代码审查
- [ ] 运行自动化测试
- [ ] 准备生产环境部署
- [ ] 制定回滚计划

## 依赖关系
- Phase 1 必须在 Phase 2 之前完成
- Phase 2 和 Phase 3 可以并行开发
- Phase 4 依赖 Phase 1-3 的完成
- Phase 5 可以在 Phase 4 开始时并行进行
- Phase 6 需要所有开发阶段完成后进行

## 验收标准
1. 管理员可以直观看到每个商品的上架状态
2. 支持单个商品一键上架/下架操作
3. 支持批量选择和状态操作
4. 所有操作都有适当的确认机制
5. 操作结果有清晰的反馈
6. 界面在不同设备上正常工作
7. 错误处理机制完善
8. 性能满足要求（操作响应时间 < 2秒）