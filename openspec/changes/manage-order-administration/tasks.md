# 任务: 实现订单管理模块

## 准备工作
1. [x] 验证 `add-admin-auth` 变更已完成并可正常使用
2. [x] 验证 `display-order-details` 变更已完成并集成订单详情功能
3. [x] 确认项目结构，理解现有订单数据模型
4. [x] 查看现有 API 端点和数据库结构

## 后端 API 开发
5. [x] 创建订单管理 API 路由 `/routes/admin/orders.ts`
6. [x] 实现订单列表查询端点（GET /api/admin/orders）
   - 支持分页参数（page, limit）
   - 支持筛选参数（status, gateway, date_from, date_to）
7. [x] 实现订单筛选端点（GET /api/admin/orders/filter-options）
   - 返回可用的筛选选项（订单状态列表、支付方式列表等）
8. [x] 实现邮件重发端点（POST /api/admin/orders/:orderId/resend）
   - 调用邮件发送服务重新发送订单发货邮件
   - 记录重发日志
9. [x] 实现退款操作端点（POST /api/admin/orders/:orderId/refund）
   - 验证订单状态（仅支持已支付订单退款）
   - 调用支付网关退款接口
   - 更新订单状态为 'refunded'
   - 记录退款日志

## 前端管理界面开发
10. [x] 创建订单管理页面组件 `frontend/src/pages/admin/OrderAdmin.tsx`
11. [x] 实现订单列表展示组件
    - 显示订单 ID、创建时间、商品信息、支付金额、状态
    - 支持分页导航
12. [x] 实现订单筛选器组件
    - 下拉选择：订单状态（待支付、已支付、已发货、已完成、已退款）
    - 下拉选择：支付方式（支付宝、Creem）
    - 日期范围选择器
    - 搜索框：订单 ID 或邮箱
13. [x] 实现订单操作功能
    - 查看详情按钮（打开订单详情模态框或页面）
    - 重发邮件按钮（仅对已发货订单显示）
    - 退款按钮（仅对已支付订单显示）
14. [x] 实现订单详情查看功能
    - 可复用 `display-order-details` 变更中的订单详情组件
    - 显示完整的订单信息、发货记录、下载记录
15. [x] 实现确认对话框
    - 邮件重发确认
    - 退款操作确认（包含风险提示）

## 错误处理与用户体验
16. [x] 添加 API 错误处理和用户反馈
    - 显示加载状态
    - 显示成功/错误消息
    - 处理网络错误
17. [x] 实现操作权限验证
    - 仅管理员可执行重发和退款操作
18. [x] 添加操作日志记录
    - 记录管理员执行的所有操作（重发、退款）

## 测试与验证
19. [x] 编写 API 端点单元测试
20. [x] 测试订单筛选功能
21. [x] 测试邮件重发功能
22. [x] 测试退款操作功能
23. [x] 进行端到端测试
24. [x] 验证操作日志记录

## 集成测试
25. [x] 与邮件服务（Resend）集成测试
26. [x] 与支付网关退款接口集成测试
27. [x] 整体后台管理系统测试
28. [x] 性能优化（订单列表加载优化）

## 文档与部署
29. [x] 编写 API 文档
30. [x] 编写用户操作指南
31. [x] 更新后台管理菜单导航
32. [x] 提交代码并验证构建
