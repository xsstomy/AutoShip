# Admin Product Management Specification - Product Creation Extension

## ADDED Requirements

### Requirement: 商品创建功能
系统 SHALL 允许管理员创建新的商品，包括基本信息和价格设置。

#### Scenario: 访问商品创建界面
- **GIVEN** 管理员已通过身份认证并在商品管理页面
- **WHEN** 管理员点击"添加商品"按钮
- **THEN** 系统 SHALL：
  1. 打开商品创建表单模态框
  2. 显示所有必要的输入字段
  3. 聚焦到商品名称输入框
  4. 阻止背景页面滚动（模态框行为）

#### Scenario: 填写商品基本信息
- **GIVEN** 管理员正在创建新商品
- **WHEN** 管理员填写商品信息表单
- **THEN** 系统 SHALL 提供以下字段：
  - 商品名称（必填，文本输入，最大长度 100 字符）
  - 商品描述（可选，多行文本输入，最大长度 500 字符）
  - 发货类型（必填，下拉选择）：
    - "text_content" - 文本内容直接发货
    - "download_link" - 下载链接发货
    - "hybrid" - 混合模式（文本+下载链接）
  - 模板文本（可选，多行文本，用于库存耗尽时）
  - 排序权重（可选，数字，默认为 0）

#### Scenario: 设置商品价格
- **GIVEN** 管理员正在填写商品创建表单
- **WHEN** 管理员设置价格信息
- **THEN** 系统 SHALL 提供：
  - CNY 价格输入框（必填，数字，最多两位小数，最小值 0.01）
  - USD 价格输入框（必填，数字，最多两位小数，最小值 0.01）
  - 实时价格格式验证和错误提示
  - 货币符号显示（¥ 和 $）

#### Scenario: 提交商品创建
- **GIVEN** 管理员已填写所有必填字段
- **WHEN** 管理员点击"创建商品"按钮
- **THEN** 系统 SHALL：
  1. 验证所有必填字段是否已填写
  2. 验证价格格式是否有效
  3. 显示提交加载状态
  4. 发送 POST 请求到后端 API
  5. 成功时显示成功提示并关闭表单
  6. 刷新商品列表显示新创建的商品

#### Scenario: 商品创建成功
- **GIVEN** 管理员提交了有效的商品创建请求
- **WHEN** 后端 API 返回成功响应
- **THEN** 系统 SHALL：
  1. 显示成功提示："商品创建成功"
  2. 关闭创建表单模态框
  3. 刷新商品列表
  4. 高亮显示新创建的商品（可选）
  5. 重置表单状态

#### Scenario: 商品创建失败
- **GIVEN** 管理员提交商品创建请求
- **WHEN** 后端 API 返回错误响应
- **THEN** 系统 SHALL：
  1. 显示错误提示信息
  2. 保持表单开启状态，保留用户输入
  3. 具体错误信息包括：
     - "商品名称已存在"
     - "价格格式无效"
     - "网络连接失败，请重试"
     - "服务器错误，请稍后重试"

### Requirement: 表单验证和用户体验
系统 SHALL 提供完善的表单验证和用户反馈机制。

#### Scenario: 实时表单验证
- **GIVEN** 管理员正在填写商品创建表单
- **WHEN** 用户输入或离开字段
- **THEN** 系统 SHALL：
  - 实时验证商品名称长度和格式
  - 实时验证价格数字格式
  - 显示字段级错误提示
  - 标记必填字段状态

#### Scenario: 提交前验证
- **GIVEN** 管理员点击"创建商品"按钮
- **WHEN** 系统执行提交前验证
- **THEN** 系统 SHALL 检查：
  - 商品名称不为空且长度有效
  - 至少设置了一个币种的价格
  - 价格为有效正数
  - 发货类型已选择
  - 如有错误，显示所有验证错误并阻止提交

#### Scenario: 取消商品创建
- **GIVEN** 管理员正在填写商品创建表单
- **WHEN** 管理员点击取消按钮或关闭模态框
- **THEN** 系统 SHALL：
  1. 如果表单有更改，显示确认对话框
  2. 确认后关闭模态框
  3. 清理表单状态
  4. 不保存任何数据

#### Scenario: 表单重置功能
- **GIVEN** 管理员正在填写商品创建表单
- **WHEN** 管理员点击"重置表单"按钮
- **THEN** 系统 SHALL：
  1. 清空所有输入字段
  2. 重置为默认值
  3. 清除所有验证错误
  4. 聚焦到商品名称输入框

### Requirement: 响应式设计
商品创建表单 SHALL 在不同设备上提供良好的用户体验。

#### Scenario: 移动端表单显示
- **GIVEN** 管理员使用移动设备访问
- **WHEN** 打开商品创建表单
- **THEN** 系统 SHALL：
  - 使用全屏模态框或可滚动模态框
  - 调整输入框和按钮大小适合触摸操作
  - 提供虚拟键盘优化（数字字段显示数字键盘）
  - 保持所有功能可访问性

#### Scenario: 平板端表单显示
- **GIVEN** 管理员使用平板设备访问
- **WHEN** 打开商品创建表单
- **THEN** 系统 SHALL：
  - 使用适中尺寸的模态框
  - 优化布局利用平板屏幕空间
  - 保持良好的可读性和操作体验

#### Scenario: 桌面端表单显示
- **GIVEN** 管理员使用桌面浏览器访问
- **WHEN** 打开商品创建表单
- **THEN** 系统 SHALL：
  - 使用居中模态框，适合桌面屏幕
  - 支持键盘导航和快捷键
  - 提供最佳的可读性和操作效率

### Requirement: 后端 API 集成
系统 SHALL 与后端 API 完整集成以支持商品创建功能。

#### Scenario: API 请求格式
- **WHEN** 前端发送商品创建请求
- **THEN** 系统 SHALL 发送：
  ```json
  {
    "name": "商品名称",
    "description": "商品描述",
    "deliveryType": "text_content|download_link|hybrid",
    "templateText": "模板文本",
    "sortOrder": 0,
    "prices": [
      {
        "currency": "CNY",
        "price": 99.99,
        "isActive": true
      },
      {
        "currency": "USD",
        "price": 14.99,
        "isActive": true
      }
    ]
  }
  ```

#### Scenario: API 响应处理
- **WHEN** 后端返回商品创建响应
- **THEN** 系统 SHALL 处理：
  - 成功响应（201 Created）：包含创建的商品信息
  - 验证错误响应（400 Bad Request）：包含字段错误详情
  - 权限错误响应（401/403）：重定向到登录页面
  - 服务器错误响应（500）：显示通用错误消息

#### Scenario: 网络错误处理
- **WHEN** 网络请求失败
- **THEN** 系统 SHALL：
  - 显示网络错误提示
  - 提供重试选项
  - 保持表单数据不丢失
  - 记录错误日志用于调试