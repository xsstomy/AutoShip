# 规格: 管理员库存管理

## ADDED Requirements

### Requirement: 库存批量导入功能
系统 SHALL 允许管理员批量导入数字商品的库存数据（卡密、文本等）。

#### 场景：导入卡密库存
- **GIVEN** 管理员已登录后台管理系统，并具备库存管理权限
- **WHEN** 管理员选择商品并上传包含卡密/文本的批量导入文件
- **THEN** 系统应解析文件内容并将其添加到对应商品的库存中
- **AND** 系统应显示导入结果（成功数量、失败数量、错误信息）

#### 场景：格式化验证
- **GIVEN** 管理员准备导入库存数据
- **WHEN** 导入文件格式不正确或缺少必要字段
- **THEN** 系统应提示格式错误并提供示例模板

#### 场景：重复数据处理
- **GIVEN** 管理员导入的库存数据包含重复内容
- **WHEN** 系统处理导入文件时
- **THEN** 系统应检测并处理重复数据（跳过或警告）

### Requirement: 库存扣减机制
系统 SHALL 在用户下单时自动扣减对应商品的库存。

#### 场景：自动扣减库存
- **GIVEN** 用户下单购买某商品
- **WHEN** 订单创建成功后
- **THEN** 系统应自动从该商品库存中扣减一个单位
- **AND** 如果库存不足，应阻止下单并提示用户

#### 场景：并发扣减保护
- **GIVEN** 多个用户同时购买同一商品
- **WHEN** 库存数量接近临界值时
- **THEN** 系统应确保库存扣减的原子性，避免超卖

#### 场景：退款库存返还
- **GIVEN** 管理员执行退款操作
- **WHEN** 退款完成后
- **THEN** 系统应将相应商品库存返还（可配置）

### Requirement: 库存信息查看
系统 SHALL 允许管理员查看商品的库存状态和详细信息。

#### 场景：查看库存列表
- **GIVEN** 管理员已登录后台管理系统
- **WHEN** 管理员访问库存管理页面
- **THEN** 系统应显示所有商品的库存信息（商品名称、当前库存、最后更新时间）

#### 场景：查看单个商品库存详情
- **GIVEN** 管理员在库存管理页面
- **WHEN** 管理员选择查看某个商品的详细库存
- **THEN** 系统应显示该商品的完整库存列表（卡密/文本内容、使用状态）

#### 场景：库存统计信息
- **GIVEN** 管理员查看库存信息
- **WHEN** 库存数据加载完成后
- **THEN** 系统应显示库存统计信息（总商品数、总库存量、低库存预警）

### Requirement: 库存数据更新
系统 SHALL 允许管理员更新和管理库存数据。

#### 场景：手动添加库存
- **GIVEN** 管理员查看库存管理页面
- **WHEN** 管理员选择手动添加库存
- **THEN** 系统应提供输入框或文件上传功能
- **AND** 添加成功后更新库存数量

#### 场景：删除库存
- **GIVEN** 管理员查看某个商品的库存详情
- **WHEN** 管理员选择删除某些库存项
- **THEN** 系统应确认后删除选中的库存项
- **AND** 更新库存总数

### Requirement: 权限控制
系统 SHALL 确保库存管理功能仅对具备权限的管理员开放。

#### 场景：权限验证
- **GIVEN** 普通用户访问库存管理页面
- **WHEN** 系统检测到用户无库存管理权限
- **THEN** 系统应阻止访问并提示权限不足

#### 场景：操作日志
- **GIVEN** 管理员执行库存相关操作
- **WHEN** 操作成功完成后
- **THEN** 系统应记录操作日志（操作人、操作类型、时间、变更内容）
