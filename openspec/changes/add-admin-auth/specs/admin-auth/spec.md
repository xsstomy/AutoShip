## ADDED Requirements
### Requirement: 管理员登录认证
系统 SHALL 为管理员提供安全的登录认证机制，确保只有授权人员能够访问后台管理系统。

#### Scenario: 管理员登录成功
- **WHEN** 管理员提供正确的用户名和密码
- **THEN** 系统验证凭据并生成JWT令牌
- **AND** 返回登录成功响应
- **AND** 设置安全cookie存储认证令牌
- **AND** 记录成功登录事件到审计日志

#### Scenario: 管理员登录失败
- **WHEN** 管理员提供错误的用户名或密码
- **THEN** 系统拒绝登录并返回错误信息
- **AND** 不泄露具体是用户名还是密码错误
- **AND** 记录失败登录尝试（包含IP地址）
- **AND** 增加失败计数器

#### Scenario: 登录尝试次数限制
- **WHEN** 同一IP地址在5分钟内连续失败5次
- **THEN** 系统临时锁定该IP地址（锁定30分钟）
- **AND** 返回安全锁定提示信息
- **AND** 发送安全告警到审计日志

### Requirement: 会话管理
系统 SHALL 管理管理员的登录会话，确保会话安全和有效性。

#### Scenario: 会话创建
- **WHEN** 管理员成功登录
- **THEN** 系统创建包含管理员ID和权限的JWT令牌
- **AND** 设置令牌过期时间为8小时
- **AND** 使用安全cookie（HttpOnly, Secure, SameSite=Strict）存储令牌
- **AND** 在数据库中记录会话信息

#### Scenario: 会话验证
- **WHEN** 管理员访问受保护的API端点
- **THEN** 系统验证JWT令牌的有效性
- **AND** 检查令牌是否过期
- **AND** 验证令牌签名是否正确
- **AND** 返回管理员信息或拒绝访问

#### Scenario: 会话超时处理
- **WHEN** JWT令牌超过8小时过期时间
- **THEN** 系统拒绝使用该令牌进行认证
- **AND** 返回401未授权状态
- **AND** 提示用户重新登录
- **AND** 清除前端的认证状态

#### Scenario: 管理员主动登出
- **WHEN** 管理员点击登出按钮
- **THEN** 系统清除认证令牌
- **AND** 从数据库中标记会话为已失效
- **AND** 重定向到登录页面
- **AND** 记录登出事件到审计日志

### Requirement: 权限验证中间件
系统 SHALL 为所有管理API实施权限验证，确保只有有权限的管理员能够执行操作。

#### Scenario: API权限检查
- **WHEN** 管理员发送API请求到管理端点
- **THEN** 系统验证请求中的JWT令牌
- **AND** 检查令牌对应的管理员权限级别
- **AND** 验证管理员是否有访问该端点的权限
- **AND** 允许访问或返回403禁止访问

#### Scenario: 无令牌访问
- **WHEN** 未认证的用户尝试访问管理API
- **THEN** 系统返回401未授权状态
- **AND** 提示需要登录
- **AND** 记录未授权访问尝试

#### Scenario: 无效令牌访问
- **WHEN** 使用过期或伪造的令牌访问管理API
- **THEN** 系统拒绝请求
- **AND** 返回401未授权状态
- **AND** 记录潜在的安全攻击事件
- **AND** 可选择性地警告管理员

### Requirement: 后台页面访问控制
系统 SHALL 在前端实施路由守卫，防止未授权用户访问管理页面。

#### Scenario: 未登录用户访问管理页面
- **WHEN** 未登录的用户直接访问管理页面URL
- **THEN** 前端检查认证状态
- **AND** 重定向到登录页面
- **AND** 记录访问尝试

#### Scenario: 已登录用户访问管理页面
- **WHEN** 已登录的管理员访问管理页面
- **THEN** 前端验证JWT令牌有效性
- **AND** 显示管理页面内容
- **AND** 加载管理员可用的功能模块

#### Scenario: 令牌即将过期提醒
- **WHEN** 管理员会话剩余时间少于30分钟
- **THEN** 前端显示会话即将过期提醒
- **AND** 提供延长会话的选项
- **AND** 即将过期时可自动刷新令牌

### Requirement: 安全审计日志
系统 SHALL 记录所有管理员相关活动，支持安全监控和审计追溯。

#### Scenario: 登录事件记录
- **WHEN** 管理员登录（成功或失败）
- **THEN** 系统记录登录时间、IP地址、用户代理
- **AND** 标记事件类型（成功/失败/锁定）
- **AND** 保存到管理员审计日志表

#### Scenario: 操作审计跟踪
- **WHEN** 管理员执行敏感操作（删除、修改配置等）
- **THEN** 系统记录操作详情、参数、结果
- **AND** 包括操作前后的数据对比
- **AND** 标记操作执行时间和管理员身份

#### Scenario: 异常行为检测
- **WHEN** 检测到异常的管理员活动模式
- **THEN** 系统标记潜在安全威胁
- **AND** 增加该管理员的监控级别
- **AND** 记录异常行为详情到安全日志

### Requirement: 密码安全策略
系统 SHALL 实施严格的密码安全策略，保护管理员账户安全。

#### Scenario: 密码哈希存储
- **WHEN** 设置或更新管理员密码
- **THEN** 系统必须使用bcrypt进行哈希
- **AND** 使用强盐值（至少12轮）
- **AND** 不以明文形式存储密码

#### Scenario: 密码强度要求
- **WHEN** 管理员设置新密码
- **THEN** 密码必须至少包含8个字符
- **AND** 包含大小写字母、数字和特殊字符
- **AND** 不能使用常见弱密码
- **AND** 不能与用户名相似

#### Scenario: 密码过期策略
- **WHEN** 管理员密码超过90天未更新
- **THEN** 系统提醒管理员更新密码
- **AND** 强制要求在下一次登录时更新
- **AND** 记录密码过期提醒事件

#### Scenario: 密码重置功能
- **WHEN** 管理员忘记密码
- **THEN** 提供安全的密码重置流程
- **AND** 通过安全的重置令牌验证身份
- **AND** 重置令牌30分钟内有效且只能使用一次
- **AND** 记录密码重置尝试事件
